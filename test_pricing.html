<!DOCTYPE html>
<html>
<head>
    <title>ESI Pricing Implementation Test</title>
</head>
<body>
    <h1>ESI Pricing Implementation Test</h1>
    <p>This page demonstrates the new ESI-based pricing system.</p>
    
    <h2>Implementation Details</h2>
    <ul>
        <li><strong>ESI Base URL:</strong> https://esi.evetech.net/latest</li>
        <li><strong>The Forge Region ID:</strong> 10000002</li>
        <li><strong>Jita 4-4 Station ID:</strong> 60003760</li>
    </ul>
    
    <h2>Pricing Algorithm</h2>
    <ol>
        <li>Fetch all sell orders from The Forge region for each item</li>
        <li>Filter orders to include only those at Jita 4-4 station</li>
        <li>Sort filtered orders by price (ascending)</li>
        <li>Calculate volume of lowest 5% of orders</li>
        <li>Return weighted average price of those orders</li>
    </ol>
    
    <h2>Test Results</h2>
    <p>Note: Network access may be restricted in test environment. The implementation includes fallback to Fuzzwork API when ESI is unavailable.</p>
    
    <button onclick="testPricing()">Test Pricing System</button>
    <div id="results"></div>
    
    <script src="js/api.js"></script>
    <script>
        async function testPricing() {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = 'Testing pricing system...';
            
            try {
                // Test with a few common items
                const testItems = new Map([
                    ['Caracal', 1],
                    ['Medium Shield Booster II', 1],
                    ['Ballistic Control System II', 1]
                ]);
                
                console.log('Testing with items:', testItems);
                const totalValue = await calculateShipValue(testItems);
                
                resultsDiv.innerHTML = `
                    <h3>Test Results</h3>
                    <p><strong>Total Value:</strong> ${totalValue.toLocaleString()} ISK</p>
                    <p>Check console for detailed logs</p>
                `;
                
            } catch (error) {
                console.error('Test error:', error);
                resultsDiv.innerHTML = `<p>Error: ${error.message}</p>`;
            }
        }
    </script>
</body>
</html>