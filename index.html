<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EVE Mission Tracker</title>
    <link rel="stylesheet" href="css/normalize.css">
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/chart.js@3.7.1/dist/chart.min.css">
</head>
<body>
    <div class="app-container">
        <header class="app-header">
            <h1>EVE Mission Tracker</h1>
        </header>
        
        <div class="main-layout">
            <!-- Left sidebar - Active mission and stats -->
            <aside class="sidebar">
                <div class="active-mission-card">
                    <h3>Active Mission</h3>
                    <div id="active-mission-info">
                        <p class="no-mission">No active mission</p>
                        <!-- Will be populated when mission is active -->
                    </div>
                    <div id="mission-timer" class="hidden">00:00:00</div>
                    <button id="start-mission-btn" class="primary-btn">Start New Mission</button>
                    <button id="end-mission-btn" class="primary-btn hidden">Complete Mission</button>
                </div>
                
                <div class="daily-stats">
                    <h3>Today's Stats</h3>
                    <div class="stat-row">
                        <span class="stat-label">Missions:</span>
                        <span id="today-missions" class="stat-value">0</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">ISK Earned:</span>
                        <span id="today-isk" class="stat-value">0 ISK</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">ISK/hr:</span>
                        <span id="today-iskhr" class="stat-value">0 ISK/hr</span>
                    </div>
                </div>
            </aside>

            <!-- Main content area -->
            <main class="content-area">
                <nav class="tab-navigation">
                    <button class="tab-btn active" data-tab="dashboard">Dashboard</button>
                    <button class="tab-btn" data-tab="missions">Missions</button>
                    <button class="tab-btn" data-tab="templates">Templates</button>
                    <button class="tab-btn" data-tab="settings">Settings</button>
                </nav>

                <!-- Tab content -->
                <div id="dashboard" class="tab-content active">
                    <h2>Dashboard</h2>
                    <div class="dashboard-grid">
                        <div class="chart-container">
                            <canvas id="earnings-chart"></canvas>
                            <h4>Earnings Over Time</h4>
                        </div>
                        <div class="chart-container">
                            <canvas id="mission-comparison-chart"></canvas>
                            <h4>Mission Comparison</h4>
                        </div>
                        <div class="stats-panel">
                            <h3>Key Metrics</h3>
                            <div class="metric-row">
                                <span>Average ISK/hr:</span>
                                <span id="avg-iskhr" class="metric-value">0 ISK/hr</span>
                            </div>
                            <div class="metric-row">
                                <span>Most Profitable Mission:</span>
                                <span id="best-mission" class="metric-value">-</span>
                            </div>
                            <div class="metric-row">
                                <span>Total Missions:</span>
                                <span id="total-missions" class="metric-value">0</span>
                            </div>
                        </div>
                        <div class="recent-missions">
                            <h3>Recent Missions</h3>
                            <ul id="recent-mission-list">
                                <!-- Will be populated dynamically -->
                                <li class="empty-list">No recent missions</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <div id="missions" class="tab-content">
                    <h2>Mission History</h2>
                    <div class="filter-controls">
                        <input type="text" id="mission-search" placeholder="Search missions...">
                        <select id="mission-filter">
                            <option value="all">All Levels</option>
                            <option value="1">Level 1</option>
                            <option value="2">Level 2</option>
                            <option value="3">Level 3</option>
                            <option value="4">Level 4</option>
                            <option value="5">Level 5</option>
                        </select>
                    </div>
                    <div class="table-container">
                        <table id="missions-table">
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>Mission</th>
                                    <th>Level</th>
                                    <th>Duration</th>
                                    <th>Income</th>
                                    <th>Expenses</th>
                                    <th>Profit</th>
                                    <th>ISK/hr</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="missions-table-body">
                                <!-- Will be populated dynamically -->
                                <tr class="empty-table">
                                    <td colspan="9">No missions recorded</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <div id="templates" class="tab-content">
                    <h2>Mission Templates</h2>
                    <button id="add-template-btn" class="primary-btn">Add New Template</button>
                    <div class="filter-controls">
                        <input type="text" id="template-search" placeholder="Search templates...">
                        <select id="template-filter">
                            <option value="all">All Factions</option>
                            <option value="amarr">Amarr Empire</option>
                            <option value="caldari">Caldari State</option>
                            <option value="gallente">Gallente Federation</option>
                            <option value="minmatar">Minmatar Republic</option>
                            <!-- More factions -->
                        </select>
                    </div>
                    <div class="templates-grid" id="templates-container">
                        <!-- Will be populated dynamically -->
                        <div class="empty-templates">No templates added yet</div>
                    </div>
                </div>

                <div id="settings" class="tab-content">
                    <h2>Settings</h2>
                    <div class="settings-group">
                        <h3>Market Settings</h3>
                        <div class="setting-row">
                            <label for="price-hub">Default Price Hub:</label>
                            <select id="price-hub">
                                <option value="jita">Jita</option>
                                <option value="amarr">Amarr</option>
                                <option value="dodixie">Dodixie</option>
                                <option value="hek">Hek</option>
                            </select>
                        </div>
                        <div class="setting-row">
                            <label for="refresh-prices">Refresh Prices on Load:</label>
                            <input type="checkbox" id="refresh-prices" checked>
                        </div>
                        <div class="setting-row">
                            <label for="pricing-strategy">Pricing Strategy:</label>
                            <select id="pricing-strategy">
                                <option value="estimation">Smart Estimation (Recommended)</option>
                                <option value="api">Try API + Fallback</option>
                                <option value="conservative">Conservative Estimates</option>
                            </select>
                        </div>
                        <div class="setting-note">
                            <p><strong>Note:</strong> Due to CORS restrictions, direct API calls may not work from GitHub Pages. Smart Estimation provides reliable price estimates based on item types.</p>
                        </div>
                    </div>
                    
                    <div class="settings-group">
                        <h3>Default Expense Values</h3>
                        <div class="setting-row">
                            <label for="default-ammo">Ammunition Cost:</label>
                            <input type="number" id="default-ammo" min="0" value="50000">
                        </div>
                        <div class="setting-row">
                            <label for="default-repairs">Repair Cost:</label>
                            <input type="number" id="default-repairs" min="0" value="10000">
                        </div>
                    </div>
                    
                    <div class="settings-group">
                        <h3>Data Management</h3>
                        <div class="setting-row">
                            <button id="export-data" class="secondary-btn">Export Data</button>
                            <button id="import-data" class="secondary-btn">Import Data</button>
                        </div>
                        <div class="setting-row">
                            <button id="reset-data" class="danger-btn">Reset All Data</button>
                        </div>
                    </div>
                    <div class="settings-group">
                        <h3>Help & Keyboard Shortcuts</h3>
                        <div class="help-section">
                            <div class="shortcut-row">
                            <span class="shortcut-key">Alt+S</span>
                            <span class="shortcut-description">Start a new mission</span>
                            </div>
                            <div class="shortcut-row">
                            <span class="shortcut-key">Alt+E</span>
                            <span class="shortcut-description">End current mission</span>
                            </div>
                            <div class="shortcut-row">
                            <span class="shortcut-key">Alt+D</span>
                            <span class="shortcut-description">View dashboard</span>
                            </div>
                            <div class="shortcut-row">
                            <span class="shortcut-key">Alt+M</span>
                            <span class="shortcut-description">View missions</span>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Modals -->
    <div id="new-mission-modal" class="modal hidden">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <h2>Start New Mission</h2>
            <form id="new-mission-form">
                <div class="form-group">
                    <label for="mission-name">Mission Name:</label>
                    <input type="text" id="mission-name" required autocomplete="off">
                    <div id="mission-suggestions" class="dropdown-suggestions hidden"></div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="mission-level">Level:</label>
                        <select id="mission-level" required>
                            <option value="1">Level 1</option>
                            <option value="2">Level 2</option>
                            <option value="3">Level 3</option>
                            <option value="4" selected>Level 4</option>
                            <option value="5">Level 5</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="agent-name">Agent:</label>
                        <input type="text" id="agent-name">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="location">Location:</label>
                        <input type="text" id="location">
                    </div>
                    <div class="form-group">
                        <label for="faction">Faction:</label>
                        <input type="text" id="faction">
                    </div>
                </div>
                <div class="form-group">
                    <label>Expected Damage Types:</label>
                    <div class="checkbox-group" id="damage-types">
                        <label><input type="checkbox" value="EM"> EM</label>
                        <label><input type="checkbox" value="Thermal"> Thermal</label>
                        <label><input type="checkbox" value="Kinetic"> Kinetic</label>
                        <label><input type="checkbox" value="Explosive"> Explosive</label>
                    </div>
                </div>
                <div class="form-group">
                    <label for="notes">Notes:</label>
                    <textarea id="mission-notes"></textarea>
                </div>
                <div class="form-actions">
                    <button type="submit" class="primary-btn">Start Mission</button>
                    <button type="button" class="secondary-btn close-btn">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <div id="complete-mission-modal" class="modal hidden">
        <div class="modal-content wide-modal">
            <span class="close-modal">&times;</span>
            <h2>Complete Mission: <span id="complete-mission-name"></span></h2>
            
            <div class="steps-indicator">
                <div class="step active" data-step="1">
                    <div class="step-number">1</div>
                    <div class="step-label">Transactions</div>
                </div>
                <div class="step" data-step="2">
                    <div class="step-number">2</div>
                    <div class="step-label">Inventory</div>
                </div>
                <div class="step" data-step="3">
                    <div class="step-number">3</div>
                    <div class="step-label">Review</div>
                </div>
            </div>
            
            <div id="step-1-content" class="step-content active">
                <h3>Paste Transaction Log</h3>
                <p class="helper-text">Copy transactions from your EVE wallet and paste below</p>
                <textarea id="transaction-paste" placeholder="Paste transaction log here..."></textarea>
                <div id="parsed-transactions" class="parsed-data hidden">
                    <h4>Detected Transactions</h4>
                    <div class="transaction-controls">
                        <button id="select-all-tx" class="small-btn">Select All</button>
                        <button id="deselect-all-tx" class="small-btn">Deselect All</button>
                    </div>
                    <div id="transaction-list" class="data-list">
                        <!-- Will be populated dynamically -->
                    </div>
                </div>
                <div class="form-actions">
                    <button id="tx-next-btn" class="primary-btn" disabled>Next Step</button>
                </div>
            </div>
            
            <div id="step-2-content" class="step-content">
                <h3>Paste Inventory Items</h3>
                <p class="helper-text">Select items in your inventory and copy (Ctrl+C), then paste below</p>
                <textarea id="inventory-paste" placeholder="Paste inventory items here..."></textarea>
                <div id="parsed-inventory" class="parsed-data hidden">
                    <h4>Detected Items</h4>
                    <div class="inventory-controls">
                        <button id="refresh-prices-btn" class="small-btn secondary-btn">🔄 Refresh Jita Prices</button>
                        <span id="price-status" class="price-status"></span>
                    </div>
                    <div id="inventory-list" class="data-list">
                        <!-- Will be populated dynamically -->
                    </div>
                    <div class="totals-row">
                        <span>Total Value:</span>
                        <span id="inventory-total-value">0 ISK</span>
                    </div>
                </div>
                <div class="form-actions">
                    <button id="inv-prev-btn" class="secondary-btn">Previous Step</button>
                    <button id="inv-next-btn" class="primary-btn" disabled>Next Step</button>
                </div>
            </div>
            
            <div id="step-3-content" class="step-content">
                <h3>Review Mission Summary</h3>
                <div class="mission-summary">
                    <div class="summary-section">
                        <h4>Mission Details</h4>
                        <div class="detail-row">
                            <span>Duration:</span>
                            <span id="summary-duration">00:00:00</span>
                        </div>
                        <div class="detail-row">
                            <span>Start Time:</span>
                            <span id="summary-start-time">--:--:--</span>
                        </div>
                        <div class="detail-row">
                            <span>End Time:</span>
                            <span id="summary-end-time">--:--:--</span>
                        </div>
                    </div>
                    
                    <div class="summary-section">
                        <h4>Income</h4>
                        <div class="detail-row">
                            <span>Bounties:</span>
                            <span id="summary-bounties">0 ISK</span>
                        </div>
                        <div class="detail-row">
                            <span>Mission Reward:</span>
                            <span id="summary-reward">0 ISK</span>
                        </div>
                        <div class="detail-row">
                            <span>Time Bonus:</span>
                            <span id="summary-bonus">0 ISK</span>
                        </div>
                        <div class="detail-row">
                            <span>Loot Value:</span>
                            <span id="summary-loot">0 ISK</span>
                        </div>
                        <div class="detail-row total-row">
                            <span>Total Income:</span>
                            <span id="summary-total-income">0 ISK</span>
                        </div>
                    </div>
                    
                    <div class="summary-section">
                        <h4>Expenses</h4>
                        <div class="form-group">
                            <label for="expense-ammo">Ammunition:</label>
                            <input type="number" id="expense-ammo" value="50000">
                        </div>
                        <div class="form-group">
                            <label for="expense-repairs">Repairs:</label>
                            <input type="number" id="expense-repairs" value="10000">
                        </div>
                        <div class="form-group">
                            <label for="expense-other">Other Expenses:</label>
                            <input type="number" id="expense-other" value="0">
                        </div>
                        <div class="detail-row total-row">
                            <span>Total Expenses:</span>
                            <span id="summary-total-expenses">60,000 ISK</span>
                        </div>
                    </div>
                    
                    <div class="summary-section results-section">
                        <div class="detail-row highlight-row">
                            <span>Net Profit:</span>
                            <span id="summary-profit">0 ISK</span>
                        </div>
                        <div class="detail-row highlight-row">
                            <span>ISK per Hour:</span>
                            <span id="summary-iskhr">0 ISK/hr</span>
                        </div>
                    </div>
                    
                    <div class="summary-section">
                        <div class="form-group">
                            <label for="final-notes">Additional Notes:</label>
                            <textarea id="final-notes"></textarea>
                        </div>
                    </div>
                </div>
                <div class="form-actions">
                    <button id="summary-prev-btn" class="secondary-btn">Previous Step</button>
                    <button id="save-mission-btn" class="primary-btn">Save Mission</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Template modal - will add later -->

    <!-- App Footer -->
    <footer class="app-footer" style="text-align:center; padding: 1em 0; font-size: 0.95em; color: #888; background: #181a1b; border-top: 1px solid #333; margin-top:2em;">
      <div>EVE Mission Tracker v1.0.2 &mdash; Created by Nesslow &mdash; <a href="https://github.com/Nesslow/eve-mission-ness" target="_blank" style="color:#6cf;">GitHub</a> &mdash; <a href="https://www.eveonline.com/" target="_blank" style="color:#6cf;">EVE Online</a><br>
      <span style="font-size:0.9em;">License: MIT</span>
      </div>
    </footer>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.1/dist/chart.min.js"></script>
    <script src="js/db.js"></script>
    <script src="js/mission-tracker.js"></script>
    <script src="js/transaction-parser.js"></script>
    <script src="js/inventory-parser.js"></script>
    <script src="js/market-api.js"></script>
    <script src="js/chart-utils.js"></script>
    <script src="js/ui-controller.js"></script>
    <script src="js/app.js"></script>
</body>
</html>